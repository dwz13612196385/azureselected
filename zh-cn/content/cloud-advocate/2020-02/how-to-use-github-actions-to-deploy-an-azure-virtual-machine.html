<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>How to use GitHub Actions to deploy a virtual machine | Azure 中文精选</title>
    <meta name="description" content="Instructional blog that helps the non-developer community deploy Azure resources using GitHub Actions.">
    <link rel="icon" href="/favicon.ico">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.5884c527.css" as="style"><link rel="preload" href="/assets/js/app.9f9b549d.js" as="script"><link rel="preload" href="/assets/js/2.6fbae5e3.js" as="script"><link rel="preload" href="/assets/js/37.e625202d.js" as="script"><link rel="preload" href="/assets/js/5.7648fdb5.js" as="script"><link rel="preload" href="/assets/js/6.4e04b220.js" as="script"><link rel="prefetch" href="/assets/js/10.1907d2aa.js"><link rel="prefetch" href="/assets/js/11.a4c62866.js"><link rel="prefetch" href="/assets/js/12.495a0e5e.js"><link rel="prefetch" href="/assets/js/13.be802129.js"><link rel="prefetch" href="/assets/js/14.d59273f9.js"><link rel="prefetch" href="/assets/js/15.4c8793cb.js"><link rel="prefetch" href="/assets/js/16.af14bd5f.js"><link rel="prefetch" href="/assets/js/17.5efbbf30.js"><link rel="prefetch" href="/assets/js/18.2676f03f.js"><link rel="prefetch" href="/assets/js/19.cb241d1c.js"><link rel="prefetch" href="/assets/js/20.6b1aa8b8.js"><link rel="prefetch" href="/assets/js/21.272292e2.js"><link rel="prefetch" href="/assets/js/22.bda450c2.js"><link rel="prefetch" href="/assets/js/23.1f0f336e.js"><link rel="prefetch" href="/assets/js/24.35b2568e.js"><link rel="prefetch" href="/assets/js/25.b620d0ab.js"><link rel="prefetch" href="/assets/js/26.739a3abd.js"><link rel="prefetch" href="/assets/js/27.e5f06b72.js"><link rel="prefetch" href="/assets/js/28.a53313ce.js"><link rel="prefetch" href="/assets/js/29.3c230e47.js"><link rel="prefetch" href="/assets/js/3.2a75d181.js"><link rel="prefetch" href="/assets/js/30.8476d7e0.js"><link rel="prefetch" href="/assets/js/31.cfa94054.js"><link rel="prefetch" href="/assets/js/32.854eb33c.js"><link rel="prefetch" href="/assets/js/33.d6c26766.js"><link rel="prefetch" href="/assets/js/34.0919884a.js"><link rel="prefetch" href="/assets/js/35.82bf0135.js"><link rel="prefetch" href="/assets/js/36.6f1cd849.js"><link rel="prefetch" href="/assets/js/38.078cb5ec.js"><link rel="prefetch" href="/assets/js/39.3651a591.js"><link rel="prefetch" href="/assets/js/4.e8a12254.js"><link rel="prefetch" href="/assets/js/40.7ce6fbf3.js"><link rel="prefetch" href="/assets/js/41.b42b0bb9.js"><link rel="prefetch" href="/assets/js/42.98e08f23.js"><link rel="prefetch" href="/assets/js/43.5cb21c60.js"><link rel="prefetch" href="/assets/js/44.096d8508.js"><link rel="prefetch" href="/assets/js/45.47cc34b2.js"><link rel="prefetch" href="/assets/js/46.0ce29280.js"><link rel="prefetch" href="/assets/js/47.02d4fc25.js"><link rel="prefetch" href="/assets/js/48.447a8678.js"><link rel="prefetch" href="/assets/js/7.c263a2a8.js"><link rel="prefetch" href="/assets/js/8.52093a0b.js"><link rel="prefetch" href="/assets/js/9.5448aaae.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5884c527.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/zh-cn/" class="home-link router-link-active"><img src="/img/logo_azure.svg" alt="Azure 中文精选" class="logo"> <span class="site-name can-hide">Azure 中文精选</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/zh-cn/" class="nav-link">首页</a></div><div class="nav-item"><a href="/zh-cn/content/" class="nav-link router-link-active">内容列表</a></div><div class="nav-item"><a href="/zh-cn/tags.html" class="nav-link">标签</a></div><div class="nav-item"><a href="https://wj.qq.com/s2/5227985/7213/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  参加翻译
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/content/cloud-advocate/2020-02/how-to-use-github-actions-to-deploy-an-azure-virtual-machine.html" class="nav-link">English</a></li><li class="dropdown-item"><!----> <a href="/zh-cn/content/cloud-advocate/2020-02/how-to-use-github-actions-to-deploy-an-azure-virtual-machine.html" class="nav-link router-link-exact-active router-link-active">简体中文</a></li><li class="dropdown-item"><!----> <a href="/zh-tw/" class="nav-link">繁體中文</a></li></ul></div></div> <a href="https://github.com/azureselected/azureselected" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/zh-cn/" class="nav-link">首页</a></div><div class="nav-item"><a href="/zh-cn/content/" class="nav-link router-link-active">内容列表</a></div><div class="nav-item"><a href="/zh-cn/tags.html" class="nav-link">标签</a></div><div class="nav-item"><a href="https://wj.qq.com/s2/5227985/7213/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  参加翻译
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/content/cloud-advocate/2020-02/how-to-use-github-actions-to-deploy-an-azure-virtual-machine.html" class="nav-link">English</a></li><li class="dropdown-item"><!----> <a href="/zh-cn/content/cloud-advocate/2020-02/how-to-use-github-actions-to-deploy-an-azure-virtual-machine.html" class="nav-link router-link-exact-active router-link-active">简体中文</a></li><li class="dropdown-item"><!----> <a href="/zh-tw/" class="nav-link">繁體中文</a></li></ul></div></div> <a href="https://github.com/azureselected/azureselected" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>How to use GitHub Actions to deploy a virtual machine</span> <!----></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="how-to-use-github-actions-to-deploy-a-virtual-machine"><a href="#how-to-use-github-actions-to-deploy-a-virtual-machine" class="header-anchor">#</a> How to use GitHub Actions to deploy a virtual machine</h1> <div class="content-meta"><hr> <p>原文： <a href="https://techcommunity.microsoft.com/t5/itops-talk-blog/how-to-use-github-actions-to-deploy-an-azure-virtual-machine/ba-p/1092015">https://techcommunity.microsoft.com/t5/itops-talk-blog/how-to-use-github-actions-to-deploy-an-azure-virtual-machine/ba-p/1092015</a></p> <p>作者： Sarah Lean | 1/22/2020</p> <!----> <div class="tags-head"><span><a href="/zh-cn/tags.html#Azure Virtual Machine">
      Azure Virtual Machine
    </a><a href="/zh-cn/tags.html#GitHub Actions">
      GitHub Actions
    </a></span></div> <hr></div> <p>Hands up if you are used to deploy servers either by unpacking them from a box or using a graphical user interface (GUI)? Yip, that’s me and it's where I’ve built my career. However, over the last few years I’ve been getting more and more used to deploying servers and their supporting resources via code. Either using something like PowerShell or Azure CLI, or sometimes a combination of both.</p> <p>I’ve also taught myself how to use tools such as Visual Studio Code, Git, GitHub or even Azure DevOps to get the task done.  It’s not been an easy journey but what it has been is fun and a challenge.</p> <p>At the end of 2019 GitHub announced <a href="https://github.blog/2019-11-14-powering-community-led-innovation-with-github-actions/" target="_blank" rel="noopener noreferrer">GitHub Actions<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, a new way to automate deployment of code from GitHub repositories.  I’ve been watching with interest as my developer focused colleagues and friends dig into the new service and show examples of it being used and have decided to take a look at it myself and see what it can do for the IT Pro community, as I’m a firm believer that these types of tools can offer IT Pros great opportunities as well.</p> <h4 id="github-actions-terminology"><a href="#github-actions-terminology" class="header-anchor">#</a> <strong>GitHub Actions Terminology</strong></h4> <p>There is some new terminology that comes with GitHub Actions, so let’s define those before we dig in.</p> <ul><li><strong>Action</strong> – these define what we can do, we can either get them from the marketplace (free) or build our own</li> <li><strong>Workflow</strong> – A collection of Environment variables, Jobs and Steps that are completed when an event happens</li> <li><strong>Jobs</strong> – What the workflow will do</li> <li><strong>Steps</strong> - A task undertaken by a Job using an Action</li> <li><strong>Event</strong> – Something that happens and triggers a workflow, e.g a commit is pushed to a repository, an issue or pull request is issued</li></ul> <h4 id="what-do-you-want-to-build"><a href="#what-do-you-want-to-build" class="header-anchor">#</a> <strong>What do you want to build?</strong></h4> <p>Keeping it simple, I want my GitHub Action to build a virtual machine (VM) within Azure. Keeping it really simple I want it to build the VM and it’s associated supporting technology (disk, network interface, virtual network, storage account, etc) within the same resource group.  This isn’t exactly best practice but is an easy example to start with and one that is well known/documented.</p> <p>I can use four blocks of Azure CLI code to build the VM within Azure.  The first block of code helps log into my Azure subscription using an Azure Service Principal and perform the necessary steps to create the VM.</p> <div class="language-markup extra-class"><pre class="language-markup"><code>#region Login
# This logs into Azure with a Service Principal Account
#
Write-Output &quot;Logging in to Azure with a service principal...&quot;
az login `
    --service-principal `
    --username $servicePrincipal `
    --password $servicePrincipalSecret `
    --tenant $servicePrincipalTenantId
Write-Output &quot;Done&quot;
Write-Output &quot;&quot;
#endregion
</code></pre></div><p>The next section selects the correct subscription, just to be sure my resources go to the right place:</p> <div class="language-markup extra-class"><pre class="language-markup"><code>#region Subscription
#This sets the subscription the resources will be created in
Write-Output &quot;Setting default azure subscription...&quot;
az account set `
    --subscription $azureSubscriptionName
Write-Output &quot;Done&quot;
Write-Output &quot;&quot;
#endregion
</code></pre></div><p>The third section creates the resource group for my VM to live in:</p> <div class="language-markup extra-class"><pre class="language-markup"><code>#region Create Resource Group
# This creates the resource group used to house the VM
Write-Output &quot;Creating resource group $resourceGroupName in region $resourceGroupNameRegion...&quot;
az group create `
    --name $resourceGroupName `
    --location $resourceGroupNameRegion
    Write-Output &quot;Done creating resource group&quot;
    Write-Output &quot;&quot;
#endregion
</code></pre></div><p>And the fourth section creates the VM within that resource group:</p> <div class="language-markup extra-class"><pre class="language-markup"><code>#region Create VM
# Create a VM in the resource group
Write-Output &quot;Creating VM...&quot;
try {
    az vm create  `
        --resource-group $resourceGroupName `
        --name $serverName `
        --image win2016datacenter `
        --admin-username $adminLogin `
        --admin-password $adminPassword
    }
catch {
    Write-Output &quot;VM already exists&quot;
    }
Write-Output &quot;Done creating VM&quot;
Write-Output &quot;&quot;
#endregion
</code></pre></div><p>The code isn’t complex and is a well-known example you can see in a lot of Documentation and tutorials. Within my script I’ve used various parameters to allow me to store the information securely or pass it in from my workflow file.  You can find my full PowerShell script <a href="https://gist.github.com/weeyin83/81e7a7bf3caf3d0bce787db5d562b47e?WT.mc_id=blog-itops-salean" target="_blank" rel="noopener noreferrer">here<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h4 id="how-do-i-instruct-the-action"><a href="#how-do-i-instruct-the-action" class="header-anchor">#</a> <strong>How do I instruct the Action?</strong></h4> <p>To kick off the VM build we construct a Workflow file. This is in the form of YAML. You can call your workflow file anything you want as long as it ends with. yml or .yaml as the extension type. It also needs to be stored within a specific directory within your GitHub repository - <strong>.github/workflows</strong></p> <p>Your workflow file is split up into several sections, let’s look at each of them individually:</p> <p><strong>Metadata</strong></p> <p>We start off with some naming the workflow:</p> <div class="language-markup extra-class"><pre class="language-markup"><code>name: GitHub for IT Pro CI/CD Pipeline
</code></pre></div><p><strong>Environment variables:</strong></p> <div class="language-markup extra-class"><pre class="language-markup"><code>Env:

  OUTPUT_PATH: $
</code></pre></div><p><strong>Triggers</strong></p> <p>We then instruct how the action will be <a href="https://help.github.com/en/actions/automating-your-workflow-with-github-actions/workflow-syntax-for-github-actions#on" target="_blank" rel="noopener noreferrer">triggered<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>; I have set my action to start whenever something is pushed to the repository:</p> <div class="language-markup extra-class"><pre class="language-markup"><code>on: [push]
</code></pre></div><p><strong>Jobs</strong></p> <p>Now we start to declare the jobs that our workflow will do, we have to start by declaring what platform our Workflow will run on (Linux, MacOS or Windows).</p> <div class="language-markup extra-class"><pre class="language-markup"><code>jobs:

# Deploy VM in Azure

  DeployVM:

    runs-on: windows-latest
</code></pre></div><p><strong>Steps</strong></p> <p>Now we can start with the steps within the workflow. The first step I’ve instructed my workflow to do a checkout. This takes the files/code from my repository and puts it into <strong>$github.workspace</strong> for my workflow to access it.</p> <div class="language-markup extra-class"><pre class="language-markup"><code>steps:

    # checkout code from repo

    - name: checkout repo

      uses: actions/checkout
</code></pre></div><p>The next step we have is one where we tell the workflow to look for the PowerShell script that helps to build the VM:</p> <div class="language-markup extra-class"><pre class="language-markup"><code>    - name: look for ps1 file

      run: |

        ls '$\IaC\AzCLI'
</code></pre></div><p>And the last step in our workflow is to deploy and provision the VM:</p> <div class="language-markup extra-class"><pre class="language-markup"><code> - name: provision virtual machine in azure

      env:

        RESOURCE_GROUP: rg-githubitpro

        RESOURCE_GROUP_REGION: southcentralus

        SERVER_NAME: gihtubactions

        ADMIN_LOGIN: sarah

      run: &gt;

        powershell -command &quot;&amp; '$\IaC\AzCLI\vmcreation.ps1'&quot;

        -servicePrincipal $

        -servicePrincipalSecret $

        -servicePrincipalTenantId $

        -azureSubscriptionName $

        -resourceGroupName %RESOURCE_GROUP%

        -resourceGroupNameRegion %RESOURCE_GROUP_REGION%

        -serverName %SERVER_NAME%

        -adminLogin %ADMIN_LOGIN%

        -adminPassword $
</code></pre></div><p>Now there is a lot to that step so let’s break down what we are doing even further:</p> <div class="language-markup extra-class"><pre class="language-markup"><code>    - name: provision virtual machine in azure

      env:

        RESOURCE_GROUP: rg-githubitpro

        RESOURCE_GROUP_REGION: southcentralus

        SERVER_NAME: gihtubactions

        ADMIN_LOGIN: sarah
</code></pre></div><p>This first part is declaring some environment variables, here I am setting my Azure Resource Group name, the region I want the resource group to be deployed in, the name of my virtual machine (server) and the name of the admin login account that will be created for that VM.</p> <p>The second stage of the step is telling my workflow to call my PowerShell script and pass in the following variables from the workflow and <a href="https://help.github.com/en/actions/automating-your-workflow-with-github-actions/creating-and-using-encrypted-secrets" target="_blank" rel="noopener noreferrer">GitHub Secrets store<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.  To allow GitHub Actions to deploy resources within my Azure Subscription I have created an Azure Service Principal. If you’ve never worked within them before I wrote an article covering how to create and work with them <a href="https://techcommunity.microsoft.com/t5/itops-talk-blog/working-with-azure-service-principal-accounts/ba-p/1086961?WT.mc_id=blog-itopstalk-salean" target="_blank" rel="noopener noreferrer">here<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <div class="language-markup extra-class"><pre class="language-markup"><code>run: &gt;

        powershell -command &quot;&amp; '$\IaC\AzCLI\vmcreation.ps1'&quot;

        -servicePrincipal $

        -servicePrincipalSecret $

        -servicePrincipalTenantId $

        -azureSubscriptionName $

        -resourceGroupName %RESOURCE_GROUP%

        -resourceGroupNameRegion %RESOURCE_GROUP_REGION%

        -serverName %SERVER_NAME%

        -adminLogin %ADMIN_LOGIN%

        -adminPassword $
</code></pre></div><p>For a full copy of this workflow file, you can find it <a href="https://gist.github.com/weeyin83/b63d320cc814dee9aebb599b847d0a49" target="_blank" rel="noopener noreferrer">here<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h4 id="monitoring-the-github-action-running"><a href="#monitoring-the-github-action-running" class="header-anchor">#</a> <strong>Monitoring the GitHub Action running</strong></h4> <p>When the Action is running you can monitor its progress. When you navigate to your repository on the GitHub website you will see a tab called Actions, click into that will take you into the Workflow section. You can create new workflows, edit workflows and monitor the progress of the workflows running.</p> <p><img src="https://gxcuf89792.i.lithium.com/t5/image/serverpage/image-id/163886i433300750608D8F9/image-size/large?v=1.0&amp;px=999" alt="undefined"><em>GitHub Actions Tab</em></p> <p><img src="https://gxcuf89792.i.lithium.com/t5/image/serverpage/image-id/163889iD61736851B0DA262/image-size/large?v=1.0&amp;px=999" alt="undefined"><em>Monitoring GitHub Actions</em></p> <p>And once the workflow has completed you can check in your Azure subscription and hopefully see the resource created:</p> <p><img src="https://gxcuf89792.i.lithium.com/t5/image/serverpage/image-id/163887i4528F2147C235951/image-size/large?v=1.0&amp;px=999" alt="undefined"><em>Azure Resources</em></p> <h4 id="things-to-think-about"><a href="#things-to-think-about" class="header-anchor">#</a> <strong>Things to think about</strong></h4> <p>My example workflow is a very basic one and the resource that I am deploying is a very basic one, however for me it was a great starting point to learn GitHub Actions. I’ve seen my colleagues use it for much more complex deployments and workflows, for example Aaron Powell is using it to <a href="https://www.aaron-powell.com/posts/2019-12-17-implementing-github-actions-for-my-blog/" target="_blank" rel="noopener noreferrer">deploy his blog<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>The <a href="https://github.com/weeyin83/vm-actions" target="_blank" rel="noopener noreferrer">repository<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> I created to test out this deployment is a public one and the output of my workflow is available for anyone logged in or not to GitHub to view, which displays certain information that could be considered as sensitive such as my Azure Subscription ID and more importantly the Public IP address of my VM, which gives people with bad intentions an easy attack surface.  So, if you are testing GitHub Actions please be aware of this and vigilant on what you deploy in Azure and how it is secured.</p> <p>I've recorded a video of me walking through the code and each step, this video can be found here:
<a href="https://youtu.be/0kDr9OlAzlM" target="_blank" rel="noopener noreferrer">https://youtu.be/0kDr9OlAzlM<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>I’d love to hear how other IT Pros are using GitHub Actions to deploy infrastructure, so please do reach out and share your stories!</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/azureselected/azureselected/edit/master/zh-cn/content/cloud-advocate/2020-02/how-to-use-github-actions-to-deploy-an-azure-virtual-machine.md" target="_blank" rel="noopener noreferrer">在 GitHub 编辑本页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">最近更新于:</span> <span class="time">2/28/2020, 4:13:07 AM</span></div></footer> <!----> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.9f9b549d.js" defer></script><script src="/assets/js/2.6fbae5e3.js" defer></script><script src="/assets/js/37.e625202d.js" defer></script><script src="/assets/js/5.7648fdb5.js" defer></script><script src="/assets/js/6.4e04b220.js" defer></script>
  </body>
</html>
